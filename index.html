<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Suitmedia</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js"
      async
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rellax/1.12.1/rellax.min.js"></script>
    <style>
      .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    </style>
  </head>
  <body class="bg-white text-gray-800">
    <!-- Header -->
    <header
      id="main-header"
      class="fixed top-0 left-0 w-full z-50 bg-white/70 backdrop-blur-md hidden transition-all duration-300 shadow"
    >
      <div class="container mx-auto flex justify-between items-center p-4">
        <h1 class="text-xl font-bold">Suitmedia</h1>
        <nav class="space-x-4">
          <a href="#" class="hover:underline">Work</a>
          <a href="#" class="hover:underline">About</a>
          <a href="#" class="hover:underline">Services</a>
          <a href="#" class="font-semibold underline">Ideas</a>
          <a href="#" class="hover:underline">Careers</a>
          <a href="#" class="hover:underline">Contact</a>
        </nav>
      </div>
    </header>

    <!-- Banner -->
    <section class="relative h-[300px] overflow-hidden">
      <div
        class="absolute inset-0 z-10 flex flex-col items-center justify-center text-white text-center bg-black/40"
      >
        <h1 class="text-4xl font-bold">Ideas</h1>
        <p class="text-lg">Where all our great things begin</p>
      </div>
      <img
        src="https://source.unsplash.com/1600x600/?creative,office"
        class="w-full h-full object-cover rellax"
        data-rellax-speed="-2"
        alt="Banner"
      />
      <div
        class="absolute bottom-0 left-0 w-full h-[60px] bg-white rotate-[-3deg] origin-bottom z-20"
      ></div>
    </section>

    <!-- Content List -->
    <section class="container mx-auto py-8 px-4">
      <div class="flex justify-between items-center mb-4">
        <div id="statusText">Showing 1 - 10 of 100</div>
        <div class="flex gap-2">
          <select id="perPage" class="border rounded px-2 py-1">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
          <select id="sortBy" class="border rounded px-2 py-1">
            <option value="-published_at">Newest</option>
            <option value="published_at">Oldest</option>
          </select>
        </div>
      </div>

      <div
        id="posts-container"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"
      ></div>

      <div id="pagination" class="flex justify-center gap-2 mt-8"></div>
    </section>

    <script>
      let currentPage = 1;
      let perPage = 10;
      let sort = "-published_at";

      const perPageSelect = document.getElementById("perPage");
      const sortBySelect = document.getElementById("sortBy");
      const statusText = document.getElementById("statusText");

      perPageSelect.addEventListener("change", (e) => {
        perPage = e.target.value;
        currentPage = 1;
        fetchPosts();
      });

      sortBySelect.addEventListener("change", (e) => {
        sort = e.target.value;
        fetchPosts();
      });

      async function fetchPosts() {
        const res = await fetch(
          `https://suitmedia-backend.suitdev.com/api/ideas?page[number]=${currentPage}&page[size]=${perPage}&append[]=small_image&append[]=medium_image&sort=${sort}`
        );
        const data = await res.json();
        renderPosts(data.data);
        renderPagination(data.meta.pagination);
        statusText.innerText = `Showing ${data.meta.pagination.from} - ${data.meta.pagination.to} of ${data.meta.pagination.total}`;
      }

      function renderPosts(posts) {
        const container = document.getElementById("posts-container");
        container.innerHTML = "";

        posts.forEach((post) => {
          const img = post.small_image?.url || "";
          const title = post.title;
          const date = new Date(post.published_at).toLocaleDateString("id-ID");

          container.innerHTML += `
          <div class="rounded shadow overflow-hidden">
            <img data-src="${img}" class="lazy w-full h-[200px] object-cover" alt="${title}">
            <div class="p-3">
              <small class="text-gray-500">${date}</small>
              <h3 class="line-clamp-3 text-md font-medium">${title}</h3>
            </div>
          </div>
        `;
        });
      }

      function renderPagination(meta) {
        const pag = document.getElementById("pagination");
        pag.innerHTML = "";

        for (let i = 1; i <= meta.last_page; i++) {
          pag.innerHTML += `
          <button class="px-3 py-1 border ${
            i === currentPage ? "bg-orange-500 text-white" : ""
          }" onclick="goToPage(${i})">${i}</button>
        `;
        }
      }

      function goToPage(page) {
        currentPage = page;
        fetchPosts();
      }

      // Header show/hide on scroll
      let prevScroll = 0;
      const header = document.getElementById("main-header");
      window.addEventListener("scroll", () => {
        const currentScroll = window.pageYOffset;
        if (currentScroll < prevScroll) {
          header.classList.remove("hidden");
        } else {
          header.classList.add("hidden");
        }
        prevScroll = currentScroll;
      });

      window.onload = () => {
        new Rellax(".rellax");
        fetchPosts();
      };
    </script>
  </body>
</html>
